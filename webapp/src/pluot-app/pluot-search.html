<link rel="import" href="../../bower_components/polymer/polymer-element.html">

<link rel="import" href="../pluot-app/pluot-globals.html">

<link rel="import" href="../../bower_components/paper-input/paper-input.html">

<dom-module id="pluot-search">
  <template>
    <style>
      paper-input {
        --paper-input-container-input-color: #fff;
        --paper-input-container-focus-color: #fff;
        background-color: #583759;
        padding-left: 16px;
        padding-right: 16px;
      }
    </style>

    <pluot-globals id="globals"></pluot-globals>

    <paper-input label="Search (e.g. cat:Groceries after:2017-08-21)" value="{{_queryStr}}" autofocus></paper-input>

  </template>

  <script>
    class PluotSearch extends Polymer.Element {
      static get is() { return 'pluot-search'; }
      static get properties() {
        return {
          query: { type: Object, computed: '_computeQuery(_queryStr)', notify: true },
          _queryStr: { type: String, value: '' },
        };
      }
      reset() {
        this._queryStr = '';
      }
      _computeQuery(_queryStr) {
        var tokens = _queryStr.split(' ');
        var query = {
          displayName: "",
          categories: [],
          before: null,
          after: null
        };
        tokens.forEach(token => {
          if (token.startsWith('cat:')) {
            query.categories.push(
              this.$.globals.categoryCode(token.substr('cat:'.length)));
          } else if (token.startsWith('after:')) {
            query.after = token.substr('after:'.length);
          } else if (token.startsWith('before:')) {
            query.before = token.substr('before:'.length);;
          }
          // TODO(robert): Support searching by display name.
        });
        return query;
      }
    }
    window.customElements.define(PluotSearch.is, PluotSearch);
  </script>
</dom-module>
